<!DOCTYPE html>
<html>
<head>
    <title>ElevenLabs TTS Test</title>
</head>
<body>
    <h1>ElevenLabs TTS Test</h1>
    <button onclick="testTTS()">Test ElevenLabs TTS</button>
    <div id="status"></div>
    
    <script>
        async function testTTS() {
            const status = document.getElementById('status');
            status.innerHTML = 'Testing ElevenLabs API...';
            
            try {
                const apiKey = 'sk_35f4b89938a76f00f869d0fdca66fe4a185de62aa9edae4a';
                const voiceId = 'JBFqnCBsd6RMkjVDRZzb';
                const testText = 'Hello, this is a test of the Oracle\'s voice.';
                
                console.log('Starting TTS test...');
                
                const response = await fetch(
                    `https://api.elevenlabs.io/v1/text-to-speech/${voiceId}?output_format=mp3_22050_32&optimize_streaming_latency=4`,
                    {
                        method: 'POST',
                        headers: {
                            'xi-api-key': apiKey,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            text: testText,
                            model_id: 'eleven_multilingual_v2',
                            voice_settings: {
                                stability: 0.7,
                                similarity_boost: 0.8,
                                style: 0.6,
                                use_speaker_boost: true,
                                speed: 0.9,
                            },
                        }),
                    }
                );
                
                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API Error: ${response.status} - ${errorText}`);
                }
                
                const audioBuffer = await response.arrayBuffer();
                console.log('Audio buffer size:', audioBuffer.byteLength);
                
                if (audioBuffer.byteLength > 0) {
                    const blob = new Blob([audioBuffer], { type: 'audio/mpeg' });
                    const audioUrl = URL.createObjectURL(blob);
                    const audio = new Audio(audioUrl);
                    
                    audio.onended = () => {
                        URL.revokeObjectURL(audioUrl);
                        status.innerHTML = '‚úÖ TTS test completed successfully!';
                    };
                    
                    audio.onerror = (error) => {
                        console.error('Audio playback error:', error);
                        status.innerHTML = '‚ùå Audio playback failed';
                    };
                    
                    status.innerHTML = 'üéµ Playing audio...';
                    await audio.play();
                } else {
                    status.innerHTML = '‚ùå Received empty audio buffer';
                }
                
            } catch (error) {
                console.error('TTS test failed:', error);
                status.innerHTML = `‚ùå TTS test failed: ${error.message}`;
            }
        }
    </script>
</body>
</html>